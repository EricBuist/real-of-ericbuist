<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta name="generator"
      content="HTML Tidy for Java (vers. 2009-12-01), see jtidy.sourceforge.net" />
      <title>
         SirCam, un autre virus
      </title>
      <meta http-equiv="Content-Type"
      content="application/xhtml+xml; charset=UTF-8" />
      <meta name="author" content="Eric Buist" />
      <meta name="viewport"
      content="width=device-width, initial-scale=1.0" />
      <meta name="HandheldFriendly" content="true" />
      <link rel="stylesheet" type="text/css"
      href="../../main.css" />
   </head>
   <body>
      <table class="topnavbar" width="100%">
         <tr>
            <td class="parents" colspan="3">
               <a href="../../index.xhtml" class="parents">Le
               royaume de Eric Buist</a> &gt;&gt; <a
               href="../index.xhtml"
               class="parents">Informatique</a> &gt;&gt; Problèmes
               marquants &gt;&gt; <a href="../resolved.xhtml"
               class="parents">Quelques bogues résolus</a> &gt;&gt;
               <a href="index.xhtml" class="parents">Bogues
               logiciels résolus</a>
            </td>
         </tr>
         <tr>
            <td class="contact">
               <a href="../../contact.xhtml" class="contact">Me
               contacter</a>
            </td>
            <td class="topnavbar">
            </td>
            <td class="sitemap">
               <a href="../../sitemap.xhtml" class="sitemap">Plan
               du site</a>
            </td>
         </tr>
         <tr>
            <td class="leftsibling">
               &lt;&lt; <a href="msnvirus.xhtml"
               class="leftsibling">Virus sur MSN</a>
            </td>
            <td class="thispage">
               SirCam, un autre virus
            </td>
            <td class="rightsibling">
               <a href="kde.xhtml" class="rightsibling">Quand KDE
               se fait vieux et parle chinois...</a> &gt;&gt;
            </td>
         </tr>
      </table>
      <h1>
         SirCam, un autre virus
      </h1>
      <p>
         Le virus sur MSN n'était pas très compliqué à éradiquer.
         Probablement qu'un logiciel anti-virus aurait réussi à le
         faire sans difficulté. Mais il existe des virus plus
         coriaces dont celui auquel j'ai été confronté le vendredi,
         21 septembre 2001 au soir. Cette fois-ci, ça a failli être
         la réinstallation longue et pénible de Windows sur le
         Pentium III, l'ordinateur familial.
      </p>
      <p>
         Tout a commencé lorsque ma mère a consulté son courriel et
         s'est rendue compte qu'elle avait reçu une trentaine de
         messages. Après examen, nous avons constaté que ces
         messages provenaient d'adresses Hotmail inconnues, ma
         soeur a été suspectée, mais puisqu'elle n'utilise pas
         Outlook Express, c'était peu probable que ce soient des
         messages pour elle. Il allait falloir faire un scan
         anti-virus, car qui sait ce que cela pourrait être.
      </p>
      <p>
         Un peu plus tard dans la soirée, lorsque l'ordinateur a
         été libre, j'ai fait le scan qui n'a rien révélé, aussi
         simple que cela. J'ai donc laissé la chose en plan pour le
         moment, mais durant la soirée, ma mère a de nouveau reçu
         un paquet de messaegs. Il allait falloir faire quelque
         chose. Il était possible que ce soit quelqu'un qui nous
         envoie tout ça et dans ce cas, ajouter un filtre dans
         Outlook Express s'imposait, voire même changer notre
         adresse de courrier! Ce qui n'a naturellement pas de bon
         sens. Cela pouvait également provenir de la machine
         elle-même.
      </p>
      <p>
         Un peu plus tard encore, je me suis décidé à analyser plus
         profondément la chose. J'ai appuyé sur CTRL+ALT+DEL pour
         voir ce qui tournait; deux programmes suspects: SaveNow et
         CnBabe. J'ai désactivé CnBabe, ce qui a fait planter
         Explorer, puis j'ai consulté le courriel: encore des
         messages suspects. J'ai tenté de désactiver SaveNow, le
         flot de messages suspects a cessé.
      </p>
      <p>
         Parlons un peu des messages eux-mêmes. Ces derniers sont
         des retours d'erreur de différents serveurs. Les messages
         seraient partis de notre machine et envoyés à d'autres de
         façon aléatoire et en cas d'erreur, ça rebondit. Le
         message que la bêbite tentait d'envoyer s'adressait à un
         prof de bio et traitait de quelque chose sur laquelle il
         demandait des conseils. Le message contenait un document
         Word très suspect, un fichier à l'extension
         <tt>.doc.com</tt> qu'un curieux, mon frère ou ma soeur, a
         ouvert, ce qui a infecté la machine.
      </p>
      <p>
         Mais pour le moment, je pensais que c'était SaveNow et je
         l'ai désactivé. Mais un nouveau message a été envoyé...
         J'ai tenté de savoir d'où venait CnBabe, le second
         suspect. C'était le module fonctionnel de Common Names,
         une extension de Internet Explorer dont l'utilité
         m'échappe. Grâce à un logiciel du nom de PrcView, j'ai
         ensuite tenté de visualiser les processus sur la machine,
         aucune information additionnelle.
      </p>
      <p>
         J'ai tenté d'aller fouiller dans la Base de Registre afin
         de savoir qu'est-ce qui aurait pu démarrer et être
         suspect. La clé
         <tt>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</tt>
         ne contenait rien de suspect,
         <tt>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</tt>
         non plus! La clé <tt>RunServices</tt>, quant à elle,
         contenait une référence du nom de <tt>Driver32</tt> à
         <tt>C:\Windows\System\SCam32.exe</tt>. Que pouvait bien
         être ce fichier? Un driver de caméra numérique, de
         scanner, je n'en savais rien. Je ne pouvais prendre le
         risque de le supprimer, car cela pourrait mener à la
         nécessité de réinstaller Windows!
      </p>
      <p>
         Je suis finalement allé sur le site de <a
         href="http://www.mcafee.com">McAfee</a>, section
         supérieure Anti-Virus, section gauche DAT files puis j'ai
         télécharger le plus récent SuperDAT. Je l'ai installé et
         l'anti-virus ainsi mis à jour, j'ai tenté un second scan
         global.
      </p>
      <p>
         Quelques temps après, j'apprenais que <tt>SCam32.exe</tt>
         constituait le virus W32/SirCam@MM, ce qui est peu
         éloquent mais tout de même une bonne hypothèse. Il est
         parfaitement plausible que le virus passe son temps à
         envoyer des e-mail à des addresses aléatoires. Cela
         provoque bien entendu un flot accru vers le serveur SMTP
         et il est même envisageable que cela soit à l'origine des
         deux pannes de connexion au cours de la semaine d'avant.
      </p>
      <p>
         McAfee m'offrait de débarrasser le système du virus, ce
         que je fis bien entendu! Bon, restait à redémarrer et
         espérer que la suppression du fichier n'affecterait pas le
         fonctionnement du système. Le redémarrage se fit sans
         problème sauf que telle ne fut pas ma surprise lorsque je
         vis de nouveau le fichier sur le disque, comme si de rien
         n'était. J'ai tenté de le supprimer, croyant que McAfee ne
         l'avait pas fait, puis j'ai redémarré, il est revenu!
      </p>
      <p>
         J'ai tenté de redémarrer en mode MS-DOS et de là, j'ai
         tapé <tt>cd \Windows\System</tt> puis <tt>dir
         scam32.exe</tt>, aucun fichier de ce nom! Après plusieurs
         recherches du fichier, rien. Je suis retourné dans
         Windows, il était toujours là, comme si de rien n'était!
         Là, je commençais à avoir un peu peur: est-ce que cela
         pouvait être un espèce de fichier fantôme ou un fichier
         virtuel? Comment trouver le véritable virus? Et s'il se
         trouvait crypté à l'intérieur du code exécutable d'amorce
         de Windows! Il était tard et il faudrait plus de temps
         pour enrayer l'anomalie... ou pour réinstaller Windows!
      </p>
      <p>
         Je tentai un dernier essai: démarrer VShield qui ralentit
         la machine, voilà pourquoi il ne tourne pas en permanence.
         Le programme ne cessait de me dire que le virus était dans
         le fichier et lorsque je le supprimais, il revenait
         toujours!
      </p>
      <p>
         J'en étais à l'hypothèse que <tt>SCam32.exe</tt> tournait
         comme service (à noter que la clé <tt>Driver32</tt>
         revenait aussi après suppression.) et recréait son
         exécutable toutes les n unités de temps. Lors de la
         fermeture de Windows, le cossin changeait de nom et
         modifiait la Base de Registre pour refléter ce changement.
         Au démarrage, il redevenait <tt>SCam32.exe</tt> et le
         règne continuait. Windows est ainsi fait que n'importe
         quoi peut entrer dedans, j'aimerais tant qu'on passe tous
         à Linux!
      </p>
      <p>
         Le lendemain matin, samedi le 22 septembre 2001, je suis
         revenu à la charge avec Norton Utilities 2001. Le CD
         pouvait contenir une version DOS d'un Éditeur de Registre
         qui me permettrait d'approfondir le problème. Il n'en fut
         rien et je dus tenter autre chose. Une disquette système
         ne contient rien non plus pour l'édition sous DOS du
         Registre, il faut absolument y penser avant et faire des
         sauvegardes régulièrement.
      </p>
      <p>
         Je découvris finalement que <tt>SCam32.exe</tt>
         constituait un fichier caché, voilà pourquoi je ne le
         trouvais pas! Sous Windows, j'avais activé l'affichage de
         Tous les fichiers. Je retournai sous DOS et je tapai, dans
         <tt>C:\Windows\System</tt>, <tt>dir /A SCAM32.EXE</tt>. Il
         était là! Je le décachai avec <tt>attrib -h
         SCAM32.EXE</tt> puis la commande <tt>del SCAM32.EXE</tt>
         eut vite raison de lui. Mais lors du redémarrage de
         Windows, il réapparut!
      </p>
      <p>
         Pas le choix, il allait falloir faire un scan sous DOS. La
         commande de scan ne se trouvait pas dans le répertoire du
         logiciel McAfee VirusScan, j'ai cru à ce moment que je ne
         pourrais le faire, qu'ils avaient seulement une version
         Windows! Toutefois, en regardant l'appel dans le fichier
         <tt>autoexec.bat</tt>, j'ai pu localiser <tt>scan</tt> et
         l'exécuter avec la commande <tt>scan /ADL /ALL
         /CLEAN</tt>. Mais c'était super long, cela ne finirait
         jamais.
      </p>
      <p>
         L'anti-virus a de nouveau détecté <tt>SCam32.exe</tt> et
         l'a supprimé, fiou! Mais il a bloqué et ne cessait de
         loader dans le répertoire <tt>Temporary Internet
         Files</tt>. N'ayant pas l'intention de passer la journée
         là-dessus, j'ai interrompu l'opération et tenté un
         redémarrage, le fichier est revenu. J'ai effectué quelques
         tests pour savoir si le code responsable de la
         régénération ne pourrait pas se trouver dans le MBR, non,
         car sous DOS, le fichier ne se recréait jamais.
      </p>
      <p>
         Je tentai de faire un scan des exécutables seulement, mais
         cela se bloqua à <tt>Temporary Internet Files</tt> une
         nouvelle fois. J'arrêtai tout, je lançai
         <tt>smartdrv</tt>, un ancien programme de cache utilisé
         sous DOS et encore disponible avec Windows dans des cas de
         figure comme celui-là. Le scan global put alors se faire
         plus rapidement et deux fichiers ont été déclarés
         infectés. Mais pas supprimés d'après ce que le programme
         me disait...
      </p>
      <p>
         À tout hasard, m'attendant à peu, j'ai redémarré Windows
         pour constater avec désespoir qu'un fichier du nom de
         <tt>sirc32.exe</tt> manquait et était nécessaire pour
         exécuter des fichiers de type <b>application</b>! Le virus
         était probablement enrayé, mais plus rien ne pouvait
         démarrer, à présent! Pendant quelques secondes, je crus
         que l'Explorateur ne démarrerait même pas, mais il
         s'amorça et tenter d'exécuter <tt>regedit</tt> menait à
         une erreur! J'étais donc bloqué!
      </p>
      <p>
         Je tentai finalement un coup audacieux: associer le type
         de fichier PAF à <tt>regedit</tt>, cela eut pour effet de
         faire démarrer l'éditeur, mais il cherchait à importer le
         fichier à l'extension <tt>.paf</tt> qui était vide, car
         créé pour l'occasion. La manoeuvre ne provoqua que des
         messages d'erreur et du désespoir, il fallait autre chose.
      </p>
      <p>
         Il me fallut créer un programme C++ que je nommerais
         <tt>sirc32.exe</tt> et qui appellerait l'exécutable
         <tt>regedit</tt>. J'aurais alors accès au programme et je
         pourrais supprimer la connexion entre le shell et
         <tt>sirc32.exe</tt>, restaurant ainsi l'intégrité
         structurelle du système. Puisque la machine était hors
         d'usage à cause de l'effet secondaire de la suppression du
         virus, j'ai dû opérer sur mon autre machine, le Faucon de
         Fer. De plus, seule ma machine est munie du compilateur
         Windows adéquat.
      </p>
      <p>
         Le fichier <tt>sirc32.cpp</tt> se lit comme suit.
      </p>
<pre>
#include &lt;windows.h&gt;

int WINAPI WinMain(HINSTANCE hInstance,
                                        HINSTANCE hPrevInst,
                                        LPSTR lpCmdLine,
                                        int nCmdShow) {
        STARTUPINFO si;
        PROCESS_INFORMATION pi;
        memset(&amp;si, 0, sizeof(si));
        si.cb = sizeof(si);
        memset(&amp;pi, 0, sizeof(pi));
        CreateProcess("C:\\Windows\\regedit.exe",
                NULL, NULL, NULL, TRUE, 0, NULL,
                NULL, &amp;si, &amp;pi);
        return 0;
}
</pre>
      <p>
         Voici sa version compilée avec Microsoft Visual C++ 6, <a
         href="sirc32.exe"><tt>sirc32.exe</tt></a>.
      </p>
      <p>
         Après avoir indiqué à Windows l'emplacement du fichier, le
         subterfuge a fonctionné: mon programme a démarré et a
         effectué sa tâche: démarrer de façon directe l'Éditeur de
         Registre! De là, je pourrais agir et enrayer l'anomalie.
         J'ai effectué une recherche de <tt>sirc32.exe</tt> pour le
         trouver dans la clé
         <tt>HKEY_CLASSES_ROOT\exefile\shell\open\command</tt>. Je
         suis allé voir sur ma machine Windows ME pour constater
         que cette clé existait! Si je l'avais supprimée
         complètement, j'aurais eu de gros ennuis. Je suis ensuite
         revenu sur la machine «malade» et j'ai supprimé la clé
         <tt>command</tt>, celle qui référait au fichier. Le
         système a alors retrouvé sa puissance nominale! Un
         redémarrage m'a confirmé le retour à la normale.
      </p>
      <p>
         En chemin, lors de mon scan sous DOS, j'ai aussi déniché
         le virus PornDia17 qui s'est retiré facilement,
         heureusement!
      </p>
      <p>
         Le virus SirCam est composé quant à lui de deux portions,
         le module fonctionnel et le module d'amorce. Le module
         d'amorce est invoqué chaque fois qu'un exécutable est
         appelé. Avant d'effectuer l'appel effectif, il va vérifier
         que le fichier <tt>SCam32.exe</tt> est bien sur la machine
         et si tel n'est pas le cas, va le recréer, ainsi qu'une
         clé dans la Base de Registre pour que le virus soit appelé
         comme service. Le module fonctionnel constitue le service
         système qui va se charger d'envoyer des courriels à des
         adresses aléatoires afin de propager le virus.
      </p>
      <p>
         Enrayer le virus se fait par la suppression de
         <tt>C:\Recycled\sirc32.exe</tt> et
         <tt>C:\Windows\System\SCam32.exe</tt> possiblement en mode
         MS-DOS pour éviter la régénération. Au préalable, il faut
         copier le fichier inoffensif <tt>sirc32.exe</tt> se
         trouvant sur cette page. Lors du démarrage de Windows, on
         appuiera sur Escape pour annuler l'exécution des
         différents programmes. En effet, si on spécifie tout de
         suite l'emplacement du nouveau <tt>sirc32.exe</tt>, il
         apparaîtra autant d'instances de <tt>regedit</tt> qu'il y
         a de programmes à appeler!
      </p>
      <p>
         De la commande <b>Exécuter</b> du menu <b>Démarrer</b>, il
         faut appeler <tt>regedit</tt> puis enfin spécifier
         l'emplacement de la version inoffensive du module
         d'amorce. Enfin, supprimer la clé <tt>command</tt> de tout
         à l'heure s'avérera nécessité puis tout devrait rentrer
         dans l'ordre. En dernier recours, bien que longue, la
         réinstallation de Windows solutionnera le problème.
      </p>
      <div class="footer">
         <a href="http://validator.w3.org/check?uri=referer"><img
         src="http://www.w3.org/Icons/valid-xhtml10"
         alt="Valid XHTML" height="31" width="88" /></a><a
         href="http://jigsaw.w3.org/css-validator/check/referer"><img
          src="http://jigsaw.w3.org/css-validator/images/vcss"
         alt="Valid CSS" height="31" width="88" /></a>
      </div>
   </body>
</html>

